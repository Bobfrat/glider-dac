{% from "macros.html" import render_field, render_field_static, render_boolean %}
{% extends "layout.html" %}

{% block title %}{{ mission.name }}{% endblock %}

{% block page %}

<h3>{{ mission.name }}</h3>

<div class="col-lg-6">

  <table class="table table-striped">
    <thead>
      <tr>
        <th>File</th>
        <th>Modified</th>
      </tr>
    </thead>
    <tbody>
    {% for f in files %}
      <tr>
        <td>{{ f[0] }}</td>
        <td>{{ f[1] | datetimeformat }}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>

  {% if editable %}

  <div id="dropbox">
    Drop files here to upload
  </div>
  <ul id="files">

  </ul>

  <script type="text/javascript">
    $(function() {
      var drop = $('#dropbox');

      drop.on('dragover', function(e) {
        e.preventDefault();
        e.stopPropagation();
      });

      drop.on('dragenter', function(e) {
        e.preventDefault();
        e.stopPropagation();

        $(this).addClass('hovered');
      });

      drop.on('dragleave', function(e) {
        $(this).removeClass('hovered'); 
      });

      drop.on('drop', function(e) {
        // prevent browser from just displaying file
        e.preventDefault();
        e.stopPropagation();

        $(this).removeClass('hovered');       

        for (var i = 0; i < e.originalEvent.dataTransfer.files.length; i++) {
          var f = e.originalEvent.dataTransfer.files[i];
          console.log(f.name);
        }
      });
    });
  </script>

  {% endif %}

</div>

<div class="col-lg-6">

  {% if editable %}
  <form name="mission_edit" id="mission_edit" method="POST" action="{{ url_for('edit_mission', username=username, mission_id=mission._id) }}">
    {{ form.hidden_tag() }}
    {{ render_field(form.estimated_deploy_date) }}
    {{ render_field(form.estimated_deploy_location) }}
    {{ render_field(form.wmo_id) }}
    {{ render_boolean(form.completed) }}
    {{ form.submit(class_="btn btn-primary") }}
  </form>
  {% else %}
  <form name="mission_edit" id="mission_edit" method="POST" action="">
    {{ render_field_static(form.estimated_deploy_date) }}
    {{ render_field_static(form.estimated_deploy_location) }}
    {{ render_field_static(form.wmo_id) }}
    {{ render_field_static(form.completed) }}
  </form>
  {% endif %}
</div>


{% endblock %}
